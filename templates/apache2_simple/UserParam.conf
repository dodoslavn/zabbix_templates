
# custom command to list all Apache2 instances
UserParameter=custom.apache2_simple-list_instances,/usr/bin/systemctl list-units --type=service -all --output=json | /usr/bin/jq -r '.[] | select(.unit | test("apache")) ' | /usr/bin/sed 's/\}/\},/' | /usr/bin/tr -d '\n' | /usr/bin/sed 's/^{/{ \"data\": [{/' | /usr/bin/sed 's/},$/}]}/' | /usr/bin/jq .

# List all domaisn for HTTP and HTTPS separately
UserParameter=custom.apache2_simple-list_domains-plain,grep -i "serveralias" /etc/apache2*/sites-enabled/*.conf 2>/dev/null | grep -v ssl | grep -v '\#NOZBX' | grep -v \* | sed 's/:/\//' | cut -d'/' -f3,6 | sed 's/\///' | sed 's/serveralias//I' | cut -d'#' -f1 | sed 's/  */ /g' |sed 's/^/{"instance":"/' | sed 's/ /", "domain": "/' | sed 's/$/"},/' | tr -d '\n' | sed 's/,$/]/' | sed 's/^/[/' | jq .
UserParameter=custom.apache2_simple-list_domains-ssl,grep -i "serveralias" /etc/apache2*/sites-enabled/*.conf 2>/dev/null | grep ssl | grep -v '\#NOZBX' | grep -v \* | sed 's/:/\//' | cut -d'/' -f3,6 | sed 's/\///' | sed 's/serveralias//I' | cut -d'#' -f1 | sed 's/  */ /g' |sed 's/^/{"instance":"/' | sed 's/ /", "domain": "/' | sed 's/$/"},/' | tr -d '\n' | sed 's/,$/]/' | sed 's/^/[/' | jq .
